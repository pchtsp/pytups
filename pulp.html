<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using it with PuLP &#8212; pytups 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=f6a572b4" />
    <script src="_static/documentation_options.js?v=8d563738"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Documentation for the Code" href="code.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pytups</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=pchtsp&repo=pytups&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="includeme.html">Pytups</a></li>
<li class="toctree-l1"><a class="reference internal" href="idea.html">Philisophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Some examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Documentation for the Code</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using it with PuLP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nomenclature">Nomenclature</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-scheduling-problem">Example: Scheduling problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mathematical-formulation">Mathematical formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation-using-pulp-and-pytups">Implementation using pulp and pytups</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="code.html" title="previous chapter">Documentation for the Code</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="using-it-with-pulp">
<h1>Using it with PuLP<a class="headerlink" href="#using-it-with-pulp" title="Link to this heading">¶</a></h1>
<p>Copied from <a class="reference external" href="https://coin-or.github.io/pulp/technical/pulp.html#module-pulp" title="(in PuLP v3.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pulp</span></code></a>:</p>
<blockquote>
<div><p>PuLP is a free open source software written in Python. It is used to describe optimisation problems as mathematical models. PuLP can then call any of numerous external LP solvers (CBC, GLPK, CPLEX, Gurobi etc) to solve this model and then use python commands to manipulate and display the solution.</p>
</div></blockquote>
<section id="nomenclature">
<h2>Nomenclature<a class="headerlink" href="#nomenclature" title="Link to this heading">¶</a></h2>
<dl class="simple glossary">
<dt id="term-Variable-declaration">Variable declaration<a class="headerlink" href="#term-Variable-declaration" title="Link to this term">¶</a></dt><dd><p>A group of decision variables that share the same naming and significance. In <cite>PuLP</cite> they are all created within a single call to <a class="reference external" href="https://coin-or.github.io/pulp/technical/pulp.html#pulp.LpVariable.dicts" title="(in PuLP v3.0)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pulp.LpVariable.dicts()</span></code></a> and they are all accessed by slicing the created <cite>python</cite> variable as a dictionary. An optimization problem can have one variable declaration but thousands of variables.</p>
</dd>
<dt id="term-Variable-domain">Variable domain<a class="headerlink" href="#term-Variable-domain" title="Link to this term">¶</a></dt><dd><p>The complete space over which variables in a single variable declaration are created. The length of the domain is the number of variables in the declaration. Each variable declaration has its own domain and is indicated with the argument <cite>index</cite> when calling the function <a class="reference external" href="https://coin-or.github.io/pulp/technical/pulp.html#pulp.LpVariable.dicts" title="(in PuLP v3.0)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pulp.LpVariable.dicts()</span></code></a>. It usually consists of some kind of iterator where all its elements should be unique.</p>
</dd>
</dl>
<p>When using <a class="reference external" href="https://coin-or.github.io/pulp/technical/pulp.html#module-pulp" title="(in PuLP v3.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pulp</span></code></a>, I use the following guidelines:</p>
<ol class="arabic simple">
<li><p>Use <a class="reference external" href="https://coin-or.github.io/pulp/technical/pulp.html#pulp.LpVariable.dicts" title="(in PuLP v3.0)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pulp.LpVariable.dicts()</span></code></a> for variable declaration, unless there is a very good reason not to.</p></li>
<li><p>Use a list of tuples to declare the variable domain.</p></li>
<li><p>Use <cite>pytups</cite> to index parts of the domain for clean, pretty and fast constraint generation.</p></li>
</ol>
</section>
<section id="example-scheduling-problem">
<h2>Example: Scheduling problem<a class="headerlink" href="#example-scheduling-problem" title="Link to this heading">¶</a></h2>
<p>This example was taken with permission from the Naval Postgraduate School course Mathematical Programming given by Matt Carlyle in 2019.</p>
<p>Assume we are given a set of jobs <span class="math notranslate nohighlight">\(j\)</span> with processing times <span class="math notranslate nohighlight">\(p_j\)</span>. For a single machine non-preemptive scheduling problem (which we assume here), a schedule of the jobs <span class="math notranslate nohighlight">\(N\)</span> is given by specifying a start time, <span class="math notranslate nohighlight">\(Y_j\)</span> , for each job. If job j starts at time <span class="math notranslate nohighlight">\(Y_j\)</span>, it is processing during the time interval <span class="math notranslate nohighlight">\([Y_j , Y_j + p_j ]\)</span>. A schedule is feasible if no two jobs have overlapping processing times.</p>
<p>This means that, for every pair of jobs <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, we have that either <span class="math notranslate nohighlight">\(Y_j \geq Y_i +p_i\)</span> , or <span class="math notranslate nohighlight">\(Y_i \geq Y_j +p_j\)</span>.</p>
<p>Job <span class="math notranslate nohighlight">\(j\)</span> will complete at time <span class="math notranslate nohighlight">\(C_j =(Y_j + p_j )\)</span>, and if it also has an associated due date, <span class="math notranslate nohighlight">\(d_j\)</span> , its tardiness, <span class="math notranslate nohighlight">\(T_j\)</span> , is defined to be:</p>
<div class="math notranslate nohighlight">
\begin{eqnarray}
   T_j    &amp; = &amp; (C_j - d_j)^+ \\
   T_j    &amp; = &amp; (Y_j + p_j - d_j)^+
\end{eqnarray}</div><p>If we are given a set of weights, <span class="math notranslate nohighlight">\(w_j\)</span> , which indicate a relative importance between individual jobs, we can calculate the total weighted tardiness of a given feasible schedule:</p>
<div class="math notranslate nohighlight">
\begin{eqnarray}
   TWT    &amp; = &amp; \sum_{j \in N} w_j T_j \\
   TWT    &amp; = &amp; \sum_{j \in N} w_j (Y_j + p_j - d_j)^+
\end{eqnarray}</div><p>The objective is to schedule all the jobs without overlapping them and minimizing the total weighted tardiness <span class="math notranslate nohighlight">\(TWT\)</span>.</p>
</section>
<section id="mathematical-formulation">
<h2>Mathematical formulation<a class="headerlink" href="#mathematical-formulation" title="Link to this heading">¶</a></h2>
<p>The following is just one of many possible formulations to solve this problem.</p>
<p>SETS</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(j \in J\)</span></p></td>
<td><p>jobs</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(k \in K = \{1, ..., C_{max}\}\)</span></p></td>
<td><p>periods</p></td>
</tr>
</tbody>
</table>
<p>DATA [UNITS]</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_j\)</span></p></td>
<td><p>processing time of job j [periods]</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(d_j\)</span></p></td>
<td><p>due date of job j [period]</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(w_j\)</span></p></td>
<td><p>weight or priority of job j [dimensionless]</p></td>
</tr>
</tbody>
</table>
<p>DERIVED DATA</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(C_{max}\)</span></p></td>
<td><p>Size of planning horizon.</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(JK\)</span></p></td>
<td><p>Al possible starting combinations (j, k) such that job <span class="math notranslate nohighlight">\(j \in J\)</span> can start in period <span class="math notranslate nohighlight">\(k \in K\)</span>.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(K_j\)</span></p></td>
<td><p>Al possible starting periods for job <span class="math notranslate nohighlight">\(j \in J\)</span>.</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(t_{jk}\)</span></p></td>
<td><p>Penalty for starting job <span class="math notranslate nohighlight">\(j \in J\)</span> in period <span class="math notranslate nohighlight">\(k \in K\)</span>.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(K2_{jk}\)</span></p></td>
<td><p>Periods that become unavailable by starting job <span class="math notranslate nohighlight">\(j\)</span> in period <span class="math notranslate nohighlight">\(k \in K\)</span>.</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(JK_{k2}\)</span></p></td>
<td><p>All possible starts of jobs <span class="math notranslate nohighlight">\((j, k) \in JK\)</span> that make period <span class="math notranslate nohighlight">\(k2 \in K\)</span> unavailable.</p></td>
</tr>
</tbody>
</table>
<div class="math notranslate nohighlight">
\begin{eqnarray}
   &amp;C_{max}  &amp;= &amp;\sum_{j \in J} p_j \\
   &amp;JK                  &amp;= &amp;\{(j \in J, k \in K) \mid k + p_j \leq C_{max} \} \\
   &amp;K_j                 &amp;= &amp;\{k \in K \mid (j, k) \in JK \} &amp; j \in J \\
   &amp;K2_{jk}  &amp;= &amp;\{k \in K \mid k \leq k2 \leq k + p_j \} &amp; (j, k) \in JK \\
   &amp;JK_{k2}  &amp;= &amp;\{(j, k) \in JK \mid k_2 \in K2_{jk} \} &amp; k_2 \in K \\
   &amp;t_{jk}      &amp;= &amp;\max\{k + p_j -1 - d_j, 0\} \times w_j &amp; (j, k) \in JK \\
\end{eqnarray}</div><p>DECISION VARIABLES</p>
<p><span class="math notranslate nohighlight">\(X_{jk}\)</span>. Binary. 1 if job <span class="math notranslate nohighlight">\(j\)</span> starts at time slot <span class="math notranslate nohighlight">\(k\)</span>, 0 otherwise. <span class="math notranslate nohighlight">\((j, k) \in JK\)</span></p>
<p>FORMULATION</p>
<div class="math notranslate nohighlight">
\begin{eqnarray}
   \min \sum_{(j, k) \in JK} t_{jk} X_{jk} \\
\end{eqnarray}</div><p>Subject to:</p>
<div class="math notranslate nohighlight">
The first set of constraints enforces that each job is scheduled only once. The second set of constraints guarantees that each period of time is used by only one job.

\begin{eqnarray}
   &amp; \sum_{k \in K_j} X_{jk} = 1 &amp; j \in J \\
   &amp; \sum_{(j, k) \in JK_{k2}} X_{jk} = 1 &amp; k2 \in K \\
\end{eqnarray}</div></section>
<section id="implementation-using-pulp-and-pytups">
<h2>Implementation using pulp and pytups<a class="headerlink" href="#implementation-using-pulp-and-pytups" title="Link to this heading">¶</a></h2>
<p>We import libraries and get input data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Example taken from the NPS course Mathematical Programming from Matt Carlyle in 2019.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pulp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytups</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pt</span>
</pre></div>
</div>
<p>We then calculate intermediate sets and parameters. Note the use of <cite>pytups</cite> functions to filter and convert from tuple lists to dictionaries.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">19</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">priority</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</pre></div>
</div>
<p>We now create the PuLP model and solve it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="mi">9</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="mi">19</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">duedate</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">133</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">133</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="mi">113</span><span class="p">,</span>
</pre></div>
</div>
<p>We get the solution from the variable contents. Not how we also use <cite>pytups</cite> to extract the content from the variable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="mi">10</span><span class="p">:</span> <span class="mi">133</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="mi">126</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="mi">117</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="mi">117</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span>
</pre></div>
</div>
<p>Finally, we do some tests on the solution using <cite>pytups</cite> to guarantee the solution is feasible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>

<span class="c1"># Get intermediate paramters, sets.</span>
<span class="n">C_max</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">duration</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">periods</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">C_max</span><span class="p">)</span>
<span class="n">tasks</span> <span class="o">=</span> <span class="n">duration</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c1"># all legal combinations of task-period assignment</span>
<span class="n">jk_all</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">TupList</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">)</span>
</pre></div>
</div>
<p>The whole code is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Example taken from the NPS course Mathematical Programming from Matt Carlyle in 2019.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pulp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytups</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pt</span>

<span class="c1"># Get input data</span>
<span class="n">duration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">19</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">priority</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="mi">19</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">duedate</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">133</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">133</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="mi">113</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="mi">133</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="mi">126</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="mi">117</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="mi">117</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span>
    <span class="mi">19</span><span class="p">:</span> <span class="mi">115</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="mi">68</span><span class="p">,</span>
<span class="p">}</span>


<span class="c1"># Get intermediate paramters, sets.</span>
<span class="n">C_max</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">duration</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">periods</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">C_max</span><span class="p">)</span>
<span class="n">tasks</span> <span class="o">=</span> <span class="n">duration</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c1"># all legal combinations of task-period assignment</span>
<span class="n">jk_all</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">TupList</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">)</span>

<span class="c1"># we filter the starts that are too late to be possible:</span>
<span class="n">JK</span> <span class="o">=</span> <span class="n">jk_all</span><span class="o">.</span><span class="n">vfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">duration</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">C_max</span><span class="p">)</span>

<span class="c1"># we create a set of tasks that can start at time period k</span>
<span class="n">K_j</span> <span class="o">=</span> <span class="n">JK</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">result_col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># all combinations (t, p, p2) such that I start a task j</span>
<span class="c1"># in time period k and is active in period k2</span>
<span class="n">jkk2</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">TupList</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">JK</span> <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="n">duration</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>

<span class="c1"># given a period k2, what starts affect make it unavailable:</span>
<span class="n">JK_k2</span> <span class="o">=</span> <span class="n">jkk2</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">result_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># given a start (j, k), what periods k2 are made unavailable:</span>
<span class="n">K2_jk</span> <span class="o">=</span> <span class="n">jkk2</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">result_col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># for each possible start: how late will the task be</span>
<span class="n">t_jk</span> <span class="o">=</span> <span class="p">{(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="nb">max</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">duedate</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">priority</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">JK</span><span class="p">}</span>


<span class="c1"># model construction with PuLP</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">LpProblem</span><span class="p">(</span><span class="s2">&quot;Scheduling&quot;</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">LpMinimize</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">LpVariable</span><span class="o">.</span><span class="n">dicts</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">indexs</span><span class="o">=</span><span class="n">JK</span><span class="p">,</span> <span class="n">lowBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upBound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cat</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">LpInteger</span>
<span class="p">)</span>

<span class="c1"># objective function:</span>
<span class="n">model</span> <span class="o">+=</span> <span class="n">pl</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_jk</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">JK</span><span class="p">)</span>

<span class="c1"># one and only one start per task</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">+=</span> <span class="n">pl</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">K_j</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>

<span class="c1"># only one task is active at any moment:</span>
<span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">+=</span> <span class="n">pl</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">JK_k2</span><span class="p">[</span><span class="n">k2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>

<span class="c1"># solve model:</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">PULP_CBC_CMD</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># solver = pl.CPLEX_CMD(msg=True)</span>
<span class="n">model</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span>


<span class="c1"># get tasks starts</span>
<span class="n">starts_out</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">SuperDict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">vapply</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span><span class="o">.</span><span class="n">keys_l</span><span class="p">()</span>

<span class="n">solution</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">]</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">starts_out</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">p2</span> <span class="ow">in</span> <span class="n">K2_jk</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]:</span>
        <span class="n">solution</span><span class="p">[</span><span class="n">p2</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;solution is </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solution</span><span class="p">))</span>


<span class="c1"># verify that all periods are filled:</span>
<span class="c1"># counting if there is any with a minus -1</span>
<span class="n">pt</span><span class="o">.</span><span class="n">TupList</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span><span class="o">.</span><span class="n">vfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># verify that each task t appears exactly duration[t] times</span>
<span class="n">task_count</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">SuperDict</span><span class="p">()</span><span class="o">.</span><span class="n">fill_with_default</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="n">duration</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solution</span><span class="p">):</span>
    <span class="n">task_count</span><span class="p">[</span><span class="n">task</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">task_count</span><span class="o">.</span><span class="n">kvapply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">duration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2025, Franco Peschiera.
      
      |
      <a href="_sources/pulp.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/pchtsp/pytups" class="github">
        <img src="_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>